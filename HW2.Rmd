---
title: "ESM204_HW2"
author: "Mia Guarnieri"
date: "4/20/2022"
output: html_document
---

1. For each irrigation district, plot the marginal abatement cost data (from the data provided) and estimate a linear regression model with zero intercept. These estimated linear regressions will be your estimates of the marginal abatement cost curve (one for each irrigation district), which you will use for the remainder of this analysis. 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(patchwork)

wd <- read_csv(here("data", "Water_Districts.csv"))

kern <- wd %>% 
  select(Reduction, MC_Kern)

mojave <- wd %>% 
  select(Reduction, MC_Mojave)

antelope <- wd %>% 
  select(Reduction, MC_Antelope)

ventura <- wd %>% 
  select(Reduction, MC_Ventura)

#Kern graph
kp <- ggplot(kern, aes(x = Reduction, y = MC_Kern)) +
  geom_line() +
  labs(x = "Acre Feet Reduction",
       y = "$/Acre Foot",
       title = "Kern")

#Mojave graph
mp <- ggplot(mojave, aes(x = Reduction, y = MC_Mojave)) +
  geom_line()+
  labs(x = "Acre Feet Reduction",
       y = "$/Acre Foot",
       title = "Mojave")

#Antelope graph
ap <- ggplot(antelope, aes(x = Reduction, y = MC_Antelope)) +
  geom_line()+
  labs(x = "Acre Feet Reduction",
       y = "$/Acre Foot",
       title = "Antelope")

#Ventura graph
vp <- ggplot(ventura, aes(x = Reduction, y = MC_Ventura)) +
  geom_line()+
  labs(x = "Acre Feet Reduction",
       y = "$/Acre Foot",
       title = "Ventura")

#combine
(kp + mp)/(ap + vp)


#linear models
kern_model <- lm(data = kern, MC_Kern ~ 0 + Reduction)
kern_coeff <- kern_model$coefficient[1]

mojave_model <- lm(data = mojave, MC_Mojave ~ 0 + Reduction)
mojave_coeff <- mojave_model$coefficient[1]

antelope_model <- lm(data = antelope, MC_Antelope ~ 0 + Reduction)
antelope_coeff <- antelope_model$coefficient[1]

ventura_model <- lm(data = ventura, MC_Ventura ~ 0 + Reduction)
ventura_coeff <- ventura_model$coefficient[1]

#lm graphs
klm <- ggplot(kern, aes(x = Reduction, y = MC_Kern)) +
  geom_point(color = "lightgrey") +
  geom_smooth(method='lm', se=FALSE, color = "turquoise4") + 
  theme_minimal() + 
  labs(x = "Acre Feet Reduction",
       y = "$/Acre Foot",
       title = "Kern")

mlm <- ggplot(mojave, aes(x = Reduction, y = MC_Mojave)) +
  geom_point(color = "lightgrey") +
  geom_smooth(method='lm', se=FALSE, color = "turquoise4") + 
  theme_minimal() + 
  labs(x = "Acre Feet Reduction",
       y = "$/Acre Foot",
       title = "Mojave")

alm <- ggplot(antelope, aes(x = Reduction, y = MC_Antelope)) +
  geom_point(color = "lightgrey") +
  geom_smooth(method='lm', se=FALSE, color = "turquoise4") + 
  theme_minimal() + 
  labs(x = "Acre Feet Reduction",
       y = "$/Acre Foot",
       title = "Antelope")

vlm <- ggplot(ventura, aes(x = Reduction, y = MC_Ventura)) +
  geom_point(color = "lightgrey") +
  geom_smooth(method='lm', se=FALSE, color = "turquoise4") + 
  theme_minimal() + 
  labs(x = "Acre Feet Reduction",
       y = "$/Acre Foot",
       title = "Ventura")

#combine
(klm + mlm)/(alm + vlm)
```

2. Using your estimated marginal abatement cost curves, derive each district’s demand curve for water. In other words, how much would each district be willing to pay for the right to use the first AF of water, second AF, etc.? Plot each district’s demand curve on a single graph. Which sector is willing to pay the most for the first AF of water? 

```{r}
#creating a dataframe to use for calculations
k_pred <- kern_coeff * seq(0, 150, length.out = 141)
m_pred <- mojave_coeff * seq(0, 150, length.out = 141)
a_pred <- antelope_coeff * seq(0, 150, length.out = 141)
v_pred <- ventura_coeff * seq(0, 150, length.out = 141)

kd <- kern %>% 
  mutate(kpmc = k_pred,
         kd = 160 - Reduction) %>% 
  select(MC_Kern, kpmc, kd)

md <- mojave %>% 
  mutate(mpmc = m_pred,
         md = 160 - Reduction) %>% 
  select(MC_Mojave, mpmc, md)

ad <- antelope %>% 
  mutate(apmc = a_pred,
         ad = 160 - Reduction)

vd <- ventura %>% 
  mutate(predicted_mc = v_pred,
         demand = 160 - Reduction)

plot_data <- wd %>% 
  mutate(kd = kd$demand,
         kpmc = kd$predicted_mc,
         md = md$demand,
         mpmc = md$predicted_mc,
         ad = ad$demand,
         apmc = ad$predicted_mc,
         vd = vd$demand,
         vpmc = vd$predicted_mc)

ggplot() +
  geom_line(kd, aes(x = demand, y = predicted_mc), color = "blue") +
  geom_line(md, aes(x = demand, y = predicted_mc), color = "green") +
  geom_line(ad, aes(x = demand, y = predicted_mc), color = "purple") +
  geom_line(vd, aes(x = demand, y = predicted_mc), color = "magenta")
```




